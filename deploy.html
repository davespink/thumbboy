<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
 
    <title>Deploy</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        iframe {
            border: 1px solid #ccc;
            border-radius: 5px;
            margin: 10px 0;
        }

        .info {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }

        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .bookmarklet-btn {
            display: inline-block;
            padding: 15px 30px;
            background-color: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            cursor: move;
            font-size: 18px;
            font-weight: bold;
            margin: 20px 0;
            transition: background-color 0.3s;
        }

        .bookmarklet-btn:hover {
            background-color: #45a049;
        }

        textarea {
            width: 100%;
            height: 200px;
            font-family: monospace;
            font-size: 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
        }

        .code-section {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }

        button {
            background-color: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background-color: #1976D2;
        }

        h1 {
            color: #333;
            text-align: center;
        }

        h2 {
            color: #4CAF50;
        }
    </style>
</head>

<body>
    <h1>Iframe Loading Test</h1>

    <div class="info">
        <p>This page demonstrates loading content via iframe and creation of a bookmarklet.</p>
    </div>
    <div class="code-section">
        <h2>Generated Bookmarklet</h2>
        <p><strong>Drag this to your bookmarks bar:</strong></p>
        <p><a class="bookmarklet-btn" href="#" id="generatedBookmarklet">üìå ThumbBoy v2.2</a></p>
        <p style="color: #666; font-style: italic;">‚¨ÜÔ∏è This bookmarklet is auto-generated from the clean code below</p>
    </div>
    <div class="code-section">
        <p><a class="bookmarklet-btn" onclick="generateBookmarklet();"
                style="background-color: goldenrod;cursor: pointer;" href="#" id="generatedBookmarklet">Generate
                Code</a></p>
        <p style="color: #666; font-style: italic;">‚¨ÜÔ∏è The bookmarklet will be auto-generated from the clean code below
        </p>
    </div>

    <script>

        function generateBookmarklet() {
            try {
                // Get the iframe element
                const iframe = document.querySelector('iframe');
                if (!iframe) {
                    throw new Error('Iframe not found');
                }
                
                // Access the iframe's document
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                if (!iframeDoc) {
                    throw new Error('Cannot access iframe content. Make sure the page is loaded.');
                }
                
                // Clone the iframe document to work with
                const docClone = iframeDoc.cloneNode(true);
                
                // Find each do_not_deploy div and remove all elements within it, then remove the div itself
                const doNotDeployDivs = docClone.querySelectorAll('#do_not_deploy, .do_not_deploy, [id*="do_not_deploy"]');
                doNotDeployDivs.forEach(div => {
                    // Remove all child elements within the div
                    while (div.firstChild) {
                        div.removeChild(div.firstChild);
                    }
                    // Remove the div itself
                    div.remove();
                });
                
                // Extract CSS from <style> tags
                const styleElements = docClone.querySelectorAll('style');
                let css = '';
                styleElements.forEach(style => {
                    css += style.textContent;
                });
                
                // Extract JavaScript from <script> tags
                const scriptElements = docClone.querySelectorAll('script');
                let js = '';
                scriptElements.forEach(script => {
                    if (script.textContent.trim()) {
                        js += script.textContent;
                    }
                });
                
                // Extract HTML body content (excluding scripts and styles)
                const bodyClone = docClone.body.cloneNode(true);
                bodyClone.querySelectorAll('script, style').forEach(el => el.remove());
                const htmlContent = bodyClone.innerHTML;
                
                // Generate the clean, combined code
                const cleanCode = `
// ThumbBoy Bookmarklet - Auto-generated from thumbboy.html via iframe
(function() {
    // Prevent multiple instances
    if (document.getElementById('thumbboy-panel')) {
        document.getElementById('thumbboy-panel').remove();
    }
    
    // Inject CSS
    var style = document.createElement('style');
    style.textContent = \`${css.replace(/`/g, '\\`').replace(/\$/g, '\\$')}\`;
    document.head.appendChild(style);
    
    // Inject HTML
    var container = document.createElement('div');
    container.innerHTML = \`${htmlContent.replace(/`/g, '\\`').replace(/\$/g, '\\$')}\`;
    document.body.appendChild(container);
    
    // Execute JavaScript
    ${js}
})();`;
                
                // Display the clean code
                document.getElementById('codeArea').value = cleanCode;
                
                // Minify the code
                let minifiedCode = cleanCode
                    .replace(/\/\*[\s\S]*?\*\//g, '') // Remove /* */ comments
                    .replace(/\/\/.*$/gm, '') // Remove // comments
                    .replace(/\s+/g, ' ') // Replace multiple spaces with single space
                    .replace(/;\s*}/g, ';}') // Remove spaces before closing braces
                    .replace(/{\s*/g, '{') // Remove spaces after opening braces
                    .replace(/}\s*/g, '}') // Remove spaces after closing braces
                    .replace(/,\s*/g, ',') // Remove spaces after commas
                    .trim();
                
                // Create bookmarklet
                const bookmarkletCode = 'javascript:' + encodeURIComponent(minifiedCode);
                
                // Update the UI
                document.getElementById('minifiedCodeArea').value = bookmarkletCode;
                document.getElementById('generatedBookmarklet').href = bookmarkletCode;
                
                // Show success message
                alert('‚úÖ Bookmarklet generated successfully from iframe content!');
                
            } catch (error) {
                console.error('Error generating bookmarklet:', error);
                alert('‚ùå Error: ' + error.message + '\n\nMake sure the iframe has loaded completely before generating.');
            }
        }

        // Wait for iframe to load, then auto-generate
        window.addEventListener('load', function() {
            const iframe = document.querySelector('iframe');
            if (iframe) {
                iframe.addEventListener('load', function() {
                    // Small delay to ensure content is fully loaded
                    setTimeout(generateBookmarklet, 500);
                });
            }
        });

    </script>

    <!-- Load the index.html file in an iframe -->
    <h2>Loading index.html:</h2>
    <iframe src="dev.html" width="100%" height="300px"></iframe>

    <!-- You can also pass parameters like in your working project


    <h2>With parameters (like your working project):</h2>
    <iframe src="index.html?project=thumbboy&mode=test" width="100%" height="300px"></iframe>

-->


    <h2>Generated Code:</h2>
    <textarea id="codeArea"></textarea>


    <h2>Minified Code:</h2>
    <textarea id="minifiedCodeArea"></textarea>

</body>

</html>